var threeSixtyPlayer,ThreeSixtyPlayer;(function(b){function a(){var n=this,i=this,g=soundManager,j=navigator.userAgent,f=(j.match(/msie/i)),e=(j.match(/opera/i)),k=(j.match(/safari/i)),c=(j.match(/chrome/i)),d=(j.match(/firefox/i)),h=(j.match(/ipad|iphone/i)),l=(typeof b.G_vmlCanvasManager==="undefined"&&typeof document.createElement("canvas").getContext("2d")!=="undefined"),m=(e||c?359.9:360);this.excludeClass="threesixty-exclude";this.links=[];this.sounds=[];this.soundsByURL=[];this.indexByURL=[];this.lastSound=null;this.lastTouchedSound=null;this.soundCount=0;this.oUITemplate=null;this.oUIImageMap=null;this.vuMeter=null;this.callbackCount=0;this.peakDataHistory=[];this.config={playNext:false,autoPlay:false,allowMultiple:false,loadRingColor:"#ccc",playRingColor:"#000",backgroundRingColor:"#eee",segmentRingColor:"rgba(255,255,255,0.33)",segmentRingColorAlt:"rgba(0,0,0,0.1)",loadRingColorMetadata:"#ddd",playRingColorMetadata:"rgba(128,192,256,0.9)",circleDiameter:null,circleRadius:null,animDuration:500,animTransition:b.Animator.tx.bouncy,showHMSTime:false,scaleFont:true,useWaveformData:false,waveformDataColor:"#0099ff",waveformDataDownsample:3,waveformDataOutside:false,waveformDataConstrain:false,waveformDataLineRatio:0.64,useEQData:false,eqDataColor:"#339933",eqDataDownsample:4,eqDataOutside:true,eqDataLineRatio:0.54,usePeakData:true,peakDataColor:"#ff33ff",peakDataOutside:true,peakDataLineRatio:0.5,useAmplifier:true,fontSizeMax:null,scaleArcWidth:1,useFavIcon:false};this.css={sDefault:"sm2_link",sBuffering:"sm2_buffering",sPlaying:"sm2_playing",sPaused:"sm2_paused"};this.addEventHandler=(typeof b.addEventListener!=="undefined"?function(r,q,p){return r.addEventListener(q,p,false)}:function(r,q,p){r.attachEvent("on"+q,p)});this.removeEventHandler=(typeof b.removeEventListener!=="undefined"?function(r,q,p){return r.removeEventListener(q,p,false)}:function(r,q,p){return r.detachEvent("on"+q,p)});this.hasClass=function(q,p){return typeof(q.className)!=="undefined"?q.className.match(new RegExp("(\\s|^)"+p+"(\\s|$)")):false};this.addClass=function(q,p){if(!q||!p||n.hasClass(q,p)){return false}q.className=(q.className?q.className+" ":"")+p};this.removeClass=function(q,p){if(!q||!p||!n.hasClass(q,p)){return false}q.className=q.className.replace(new RegExp("( "+p+")|("+p+")","g"),"")};this.getElementsByClassName=function(s,o,v){var u=(v||document),t=[],r,q,p=[];if(typeof o!=="undefined"&&typeof o!=="string"){for(r=o.length;r--;){if(!p||!p[o[r]]){p[o[r]]=u.getElementsByTagName(o[r])}}}else{if(o){p=u.getElementsByTagName(o)}else{p=u.all||u.getElementsByTagName("*")}}if(typeof(o)!=="string"){for(r=o.length;r--;){for(q=p[o[r]].length;q--;){if(n.hasClass(p[o[r]][q],s)){t.push(p[o[r]][q])}}}}else{for(r=0;r<p.length;r++){if(n.hasClass(p[r],s)){t.push(p[r])}}}return t};this.getParentByNodeName=function(p,o){if(!p||!o){return false}o=o.toLowerCase();while(p.parentNode&&o!==p.parentNode.nodeName.toLowerCase()){p=p.parentNode}return(p.parentNode&&o===p.parentNode.nodeName.toLowerCase()?p.parentNode:null)};this.getParentByClassName=function(p,o){if(!p||!o){return false}while(p.parentNode&&!n.hasClass(p.parentNode,o)){p=p.parentNode}return(p.parentNode&&n.hasClass(p.parentNode,o)?p.parentNode:null)};this.getSoundByURL=function(o){return(typeof n.soundsByURL[o]!=="undefined"?n.soundsByURL[o]:null)};this.isChildOfNode=function(q,p){if(!q||!q.parentNode){return false}p=p.toLowerCase();do{q=q.parentNode}while(q&&q.parentNode&&q.nodeName.toLowerCase()!==p);return(q&&q.nodeName.toLowerCase()===p?q:null)};this.isChildOfClass=function(p,o){if(!p||!o){return false}while(p.parentNode&&!n.hasClass(p,o)){p=n.findParent(p)}return(n.hasClass(p,o))};this.findParent=function(p){if(!p||!p.parentNode){return false}p=p.parentNode;if(p.nodeType===2){while(p&&p.parentNode&&p.parentNode.nodeType===2){p=p.parentNode}}return p};this.getStyle=function(r,p){try{if(r.currentStyle){return r.currentStyle[p]}else{if(b.getComputedStyle){return document.defaultView.getComputedStyle(r,null).getPropertyValue(p)}}}catch(q){}return null};this.findXY=function(p){var q=0,o=0;do{q+=p.offsetLeft;o+=p.offsetTop}while(!!(p=p.offsetParent));return[q,o]};this.getMouseXY=function(o){o=o?o:b.event;if(h&&o.touches){o=o.touches[0]}if(o.pageX||o.pageY){return[o.pageX,o.pageY]}else{if(o.clientX||o.clientY){return[o.clientX+n.getScrollLeft(),o.clientY+n.getScrollTop()]}}};this.getScrollLeft=function(){return(document.body.scrollLeft+document.documentElement.scrollLeft)};this.getScrollTop=function(){return(document.body.scrollTop+document.documentElement.scrollTop)};this.events={play:function(){i.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className=i.css.sPlaying;i.addClass(this._360data.oUIBox,this._360data.className);n.fanOut(this)},stop:function(){i.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className="";n.fanIn(this)},pause:function(){i.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className=i.css.sPaused;i.addClass(this._360data.oUIBox,this._360data.className)},resume:function(){i.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className=i.css.sPlaying;i.addClass(this._360data.oUIBox,this._360data.className)},finish:function(){var o;i.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className="";this._360data.didFinish=true;n.fanIn(this);if(i.config.playNext){o=(i.indexByURL[this._360data.oLink.href]+1);if(o<i.links.length){i.handleClick({target:i.links[o]})}}},whileloading:function(){if(this.paused){n.updatePlaying.apply(this)}},whileplaying:function(){n.updatePlaying.apply(this);this._360data.fps++},bufferchange:function(){if(this.isBuffering){i.addClass(this._360data.oUIBox,i.css.sBuffering)}else{i.removeClass(this._360data.oUIBox,i.css.sBuffering)}}};this.stopEvent=function(o){if(typeof o!=="undefined"&&typeof o.preventDefault!=="undefined"){o.preventDefault()}else{if(typeof b.event!=="undefined"&&typeof b.event.returnValue!=="undefined"){b.event.returnValue=false}}return false};this.getTheDamnLink=(f)?function(o){return(o&&o.target?o.target:b.event.srcElement)}:function(o){return o.target};this.handleClick=function(u){if(u.button>1){return true}var w=n.getTheDamnLink(u),t,v,p,q,s,r;if(w.nodeName.toLowerCase()!=="a"){w=n.isChildOfNode(w,"a");if(!w){return true}}if(!n.isChildOfClass(w,"ui360")){return true}t=w.getAttribute("href");if(!w.href||!g.canPlayLink(w)||n.hasClass(w,n.excludeClass)){return true}g._writeDebug("handleClick()");v=(w.href);p=n.getSoundByURL(v);if(p){if(p===n.lastSound){p.togglePause()}else{p.togglePause();g._writeDebug("sound different than last sound: "+n.lastSound.id);if(!n.config.allowMultiple&&n.lastSound){n.stopSound(n.lastSound)}}}else{q=w.parentNode;s=(n.getElementsByClassName("ui360-vis","div",q.parentNode).length);p=g.createSound({id:"ui360Sound"+(n.soundCount++),url:v,onplay:n.events.play,onstop:n.events.stop,onpause:n.events.pause,onresume:n.events.resume,onfinish:n.events.finish,onbufferchange:n.events.bufferchange,type:(w.type||null),whileloading:n.events.whileloading,whileplaying:n.events.whileplaying,useWaveformData:(s&&n.config.useWaveformData),useEQData:(s&&n.config.useEQData),usePeakData:(s&&n.config.usePeakData)});r=parseInt(n.getElementsByClassName("sm2-360ui","div",q)[0].offsetWidth,10);p._360data={oUI360:n.getParentByClassName(w,"ui360"),oLink:w,className:n.css.sPlaying,oUIBox:n.getElementsByClassName("sm2-360ui","div",q)[0],oCanvas:n.getElementsByClassName("sm2-canvas","canvas",q)[0],oButton:n.getElementsByClassName("sm2-360btn","span",q)[0],oTiming:n.getElementsByClassName("sm2-timing","div",q)[0],oCover:n.getElementsByClassName("sm2-cover","div",q)[0],circleDiameter:r,circleRadius:r/2,lastTime:null,didFinish:null,pauseCount:0,radius:0,fontSize:1,fontSizeMax:n.config.fontSizeMax,scaleFont:(s&&n.config.scaleFont),showHMSTime:s,amplifier:(s&&n.config.usePeakData?0.9:1),radiusMax:r*0.175,width:0,widthMax:r*0.4,lastValues:{bytesLoaded:0,bytesTotal:0,position:0,durationEstimate:0},animating:false,oAnim:new b.Animator({duration:n.config.animDuration,transition:n.config.animTransition,onComplete:function(){}}),oAnimProgress:function(x){var o=this;o._360data.radius=parseInt(o._360data.radiusMax*o._360data.amplifier*x,10);o._360data.width=parseInt(o._360data.widthMax*o._360data.amplifier*x,10);if(o._360data.scaleFont&&o._360data.fontSizeMax!==null){o._360data.oTiming.style.fontSize=parseInt(Math.max(1,o._360data.fontSizeMax*x),10)+"px";o._360data.oTiming.style.opacity=x}if(o.paused||o.playState===0||o._360data.lastValues.bytesLoaded===0||o._360data.lastValues.position===0){n.updatePlaying.apply(o)}},fps:0};if(typeof n.Metadata!=="undefined"&&n.getElementsByClassName("metadata","div",p._360data.oUI360).length){p._360data.metadata=new n.Metadata(p,n)}if(p._360data.scaleFont&&p._360data.fontSizeMax!==null){p._360data.oTiming.style.fontSize="1px"}p._360data.oAnim.addSubject(p._360data.oAnimProgress,p);n.refreshCoords(p);n.updatePlaying.apply(p);n.soundsByURL[v]=p;n.sounds.push(p);if(!n.config.allowMultiple&&n.lastSound){n.stopSound(n.lastSound)}p.play()}n.lastSound=p;if(typeof u!=="undefined"&&typeof u.preventDefault!=="undefined"){u.preventDefault()}else{if(typeof b.event!=="undefined"){b.event.returnValue=false}}return false};this.fanOut=function(p){var o=p;if(o._360data.animating===1){return false}o._360data.animating=0;soundManager._writeDebug("fanOut: "+o.id+": "+o._360data.oLink.href);o._360data.oAnim.seekTo(1);b.setTimeout(function(){o._360data.animating=0},n.config.animDuration+20)};this.fanIn=function(p){var o=p;if(o._360data.animating===-1){return false}o._360data.animating=-1;soundManager._writeDebug("fanIn: "+o.id+": "+o._360data.oLink.href);o._360data.oAnim.seekTo(0);b.setTimeout(function(){o._360data.didFinish=false;o._360data.animating=0;n.resetLastValues(o)},n.config.animDuration+20)};this.resetLastValues=function(o){o._360data.lastValues.position=0};this.refreshCoords=function(o){o._360data.canvasXY=n.findXY(o._360data.oCanvas);o._360data.canvasMid=[o._360data.circleRadius,o._360data.circleRadius];o._360data.canvasMidXY=[o._360data.canvasXY[0]+o._360data.canvasMid[0],o._360data.canvasXY[1]+o._360data.canvasMid[1]]};this.stopSound=function(o){soundManager._writeDebug("stopSound: "+o.id);soundManager.stop(o.id);if(!h){soundManager.unload(o.id)}};this.buttonClick=function(p){var q=p?(p.target?p.target:p.srcElement):b.event.srcElement;n.handleClick({target:n.getParentByClassName(q,"sm2-360ui").nextSibling});return false};this.buttonMouseDown=function(o){if(!h){document.onmousemove=function(p){n.mouseDown(p)}}else{n.addEventHandler(document,"touchmove",n.mouseDown)}n.stopEvent(o);return false};this.mouseDown=function(r){if(!h&&r.button>1){return true}if(!n.lastSound){n.stopEvent(r);return false}var o=r?r:b.event,q,p,s;if(h&&o.touches){o=o.touches[0]}q=(o.target||o.srcElement);p=n.getSoundByURL(n.getElementsByClassName("sm2_link","a",n.getParentByClassName(q,"ui360"))[0].href);n.lastTouchedSound=p;n.refreshCoords(p);s=p._360data;n.addClass(s.oUIBox,"sm2_dragging");s.pauseCount=(n.lastTouchedSound.paused?1:0);n.mmh(r?r:b.event);if(h){n.removeEventHandler(document,"touchmove",n.mouseDown);n.addEventHandler(document,"touchmove",n.mmh);n.addEventHandler(document,"touchend",n.mouseUp)}else{document.onmousemove=n.mmh;document.onmouseup=n.mouseUp}n.stopEvent(r);return false};this.mouseUp=function(o){var p=n.lastTouchedSound._360data;n.removeClass(p.oUIBox,"sm2_dragging");if(p.pauseCount===0){n.lastTouchedSound.resume()}if(!h){document.onmousemove=null;document.onmouseup=null}else{n.removeEventHandler(document,"touchmove",n.mmh);n.removeEventHandler(document,"touchend",n.mouseUP)}};this.mmh=function(t){if(typeof t==="undefined"){t=b.event}var r=n.lastTouchedSound,s=n.getMouseXY(t),p=s[0],v=s[1],q=p-r._360data.canvasMidXY[0],o=v-r._360data.canvasMidXY[1],u=Math.floor(m-(n.rad2deg(Math.atan2(q,o))+180));r.setPosition(r.durationEstimate*(u/m));n.stopEvent(t);return false};this.drawSolidArc=function(t,s,u,o,r,v,C){var B=u,A=u,q=t,D,w,p,z;if(q.getContext){D=q.getContext("2d")}t=D;if(!C){n.clearCanvas(q)}if(s){D.fillStyle=s}t.beginPath();if(isNaN(r)){r=0}w=u-o;p=(e||k);if(!p||(p&&u>0)){t.arc(0,0,u,v,r,false);z=n.getArcEndpointCoords(w,r);t.lineTo(z.x,z.y);t.arc(0,0,w,r,v,true);t.closePath();t.fill()}};this.getArcEndpointCoords=function(o,p){return{x:o*Math.cos(p),y:o*Math.sin(p)}};this.deg2rad=function(o){return(o*Math.PI/180)};this.rad2deg=function(o){return(o*180/Math.PI)};this.getTime=function(p,q){var o=Math.floor(p/1000),r=Math.floor(o/60),s=o-(r*60);return(q?(r+":"+(s<10?"0"+s:s)):{min:r,sec:s})};this.clearCanvas=function(s){var q=s,p=null,r,o;if(q.getContext){p=q.getContext("2d")}r=q.offsetWidth;o=q.offsetHeight;p.clearRect(-(r/2),-(o/2),r,o)};this.updatePlaying=function(){var o=(this._360data.showHMSTime?n.getTime(this.position,true):parseInt(this.position/1000,10));var p=n.config.scaleArcWidth;if(this.bytesLoaded){this._360data.lastValues.bytesLoaded=this.bytesLoaded;this._360data.lastValues.bytesTotal=this.bytesTotal}if(this.position){this._360data.lastValues.position=this.position}if(this.durationEstimate){this._360data.lastValues.durationEstimate=this.durationEstimate}n.drawSolidArc(this._360data.oCanvas,n.config.backgroundRingColor,this._360data.width,this._360data.radius*p,n.deg2rad(m),false);n.drawSolidArc(this._360data.oCanvas,(this._360data.metadata?n.config.loadRingColorMetadata:n.config.loadRingColor),this._360data.width,this._360data.radius*p,n.deg2rad(m*(this._360data.lastValues.bytesLoaded/this._360data.lastValues.bytesTotal)),0,true);if(this._360data.lastValues.position!==0){n.drawSolidArc(this._360data.oCanvas,(this._360data.metadata?n.config.playRingColorMetadata:n.config.playRingColor),this._360data.width,this._360data.radius*p,n.deg2rad((this._360data.didFinish===1?m:m*(this._360data.lastValues.position/this._360data.lastValues.durationEstimate))),0,true)}if(this._360data.metadata){this._360data.metadata.events.whileplaying()}if(o!==this._360data.lastTime){this._360data.lastTime=o;this._360data.oTiming.innerHTML=o}if((this.instanceOptions.useWaveformData||this.instanceOptions.useEQData)&&l){n.updateWaveform(this)}if(n.config.useFavIcon&&n.vuMeter){n.vuMeter.updateVU(this)}};this.updateWaveform=function(w){if((!n.config.useWaveformData&&!n.config.useEQData)||(!g.features.waveformData&&!g.features.eqData)){return false}if(!w.waveformData.left.length&&!w.eqData.length&&!w.peakData.left){return false}var y=w._360data.oCanvas.getContext("2d"),I=0,H=parseInt(w._360data.circleDiameter/2,10),L=H/2,o=1,p=1,v=0,r=H,F,E,K,J,t,z,D,C,q,s,G,x,B,M,A,u;if(n.config.useWaveformData){J=n.config.waveformDataDownsample;J=Math.max(1,J);t=256;z=(t/J);D=0;C=0;q=null;s=(n.config.waveformDataOutside?1:(n.config.waveformDataConstrain?0.5:0.565));L=(n.config.waveformDataOutside?0.7:0.75);G=n.deg2rad((360/z)*n.config.waveformDataLineRatio);for(F=0;F<t;F+=J){D=n.deg2rad(360*(F/(z)*1/J));C=D+G;q=w.waveformData.left[F];if(q<0&&n.config.waveformDataConstrain){q=Math.abs(q)}n.drawSolidArc(w._360data.oCanvas,n.config.waveformDataColor,w._360data.width*s*(2-n.config.scaleArcWidth),w._360data.radius*L*1.25*q,C,D,true)}}if(n.config.useEQData){J=n.config.eqDataDownsample;x=0;J=Math.max(1,J);B=192;z=(B/J);s=(n.config.eqDataOutside?1:0.565);K=(n.config.eqDataOutside?-1:1);L=(n.config.eqDataOutside?0.5:0.75);D=0;C=0;G=n.deg2rad((360/z)*n.config.eqDataLineRatio);M=n.deg2rad((w._360data.didFinish===1?360:360*(w._360data.lastValues.position/w._360data.lastValues.durationEstimate)));E=0;A=0;for(F=0;F<B;F+=J){D=n.deg2rad(360*(F/B));C=D+G;n.drawSolidArc(w._360data.oCanvas,(C>M?n.config.eqDataColor:n.config.playRingColor),w._360data.width*s,w._360data.radius*L*(w.eqData.left[F]*K),C,D,true)}}if(n.config.usePeakData){if(!w._360data.animating){u=(w.peakData.left||w.peakData.right);B=3;for(F=0;F<B;F++){u=(u||w.eqData[F])}w._360data.amplifier=(n.config.useAmplifier?(0.9+(u*0.1)):1);w._360data.radiusMax=w._360data.circleDiameter*0.175*w._360data.amplifier;w._360data.widthMax=w._360data.circleDiameter*0.4*w._360data.amplifier;w._360data.radius=parseInt(w._360data.radiusMax*w._360data.amplifier,10);w._360data.width=parseInt(w._360data.widthMax*w._360data.amplifier,10)}}};this.getUIHTML=function(o){return['<canvas class="sm2-canvas" width="'+o+'" height="'+o+'"></canvas>',' <span class="sm2-360btn sm2-360btn-default"></span>',' <div class="sm2-timing'+(navigator.userAgent.match(/safari/i)?" alignTweak":"")+'"></div>',' <div class="sm2-cover"></div>']};this.uiTest=function(p){var s=document.createElement("div"),q,w,u,r,o,x,y,v,t;s.className="sm2-360ui";q=document.createElement("div");q.className="ui360"+(p?" "+p:"");w=q.appendChild(s.cloneNode(true));q.style.position="absolute";q.style.left="-9999px";u=document.body.appendChild(q);r=w.offsetWidth;o=n.getUIHTML(r);w.innerHTML=o[1]+o[2]+o[3];x=parseInt(w.offsetWidth,10);y=parseInt(x/2,10);t=n.getElementsByClassName("sm2-timing","div",u)[0];v=parseInt(n.getStyle(t,"font-size"),10);if(isNaN(v)){v=null}q.parentNode.removeChild(q);o=q=w=u=null;return{circleDiameter:x,circleRadius:y,fontSizeMax:v}};this.init=function(){g._writeDebug("threeSixtyPlayer.init()");var u=n.getElementsByClassName("ui360","div"),D,C,G=[],x=false,w=0,v,r,A,t,q,s,y,E,p,z,B,F;for(D=0,C=u.length;D<C;D++){G.push(u[D].getElementsByTagName("a")[0]);u[D].style.backgroundImage="none"}n.oUITemplate=document.createElement("div");n.oUITemplate.className="sm2-360ui";n.oUITemplateVis=document.createElement("div");n.oUITemplateVis.className="sm2-360ui";s=n.uiTest();n.config.circleDiameter=s.circleDiameter;n.config.circleRadius=s.circleRadius;y=n.uiTest("ui360-vis");n.config.fontSizeMax=y.fontSizeMax;n.oUITemplate.innerHTML=n.getUIHTML(n.config.circleDiameter).join("");n.oUITemplateVis.innerHTML=n.getUIHTML(y.circleDiameter).join("");for(D=0,C=G.length;D<C;D++){if(g.canPlayLink(G[D])&&!n.hasClass(G[D],n.excludeClass)&&!n.hasClass(G[D],n.css.sDefault)){n.addClass(G[D],n.css.sDefault);n.links[w]=(G[D]);n.indexByURL[G[D].href]=w;w++;x=n.hasClass(G[D].parentNode,"ui360-vis");t=(x?y:s).circleDiameter;q=(x?y:s).circleRadius;E=G[D].parentNode.insertBefore((x?n.oUITemplateVis:n.oUITemplate).cloneNode(true),G[D]);if(f&&typeof b.G_vmlCanvasManager!=="undefined"){z=G[D].parentNode;B=document.createElement("canvas");B.className="sm2-canvas";F="sm2_canvas_"+parseInt(Math.random()*1048576,10);B.id=F;B.width=t;B.height=t;E.appendChild(B);b.G_vmlCanvasManager.initElement(B);v=document.getElementById(F)}else{v=G[D].parentNode.getElementsByTagName("canvas")[0]}A=n.getElementsByClassName("sm2-cover","div",G[D].parentNode)[0];p=G[D].parentNode.getElementsByTagName("span")[0];n.addEventHandler(p,"click",n.buttonClick);if(!h){n.addEventHandler(A,"mousedown",n.mouseDown)}else{n.addEventHandler(A,"touchstart",n.mouseDown)}r=v.getContext("2d");r.translate(q,q);r.rotate(n.deg2rad(-90))}}if(w>0){n.addEventHandler(document,"click",n.handleClick);if(n.config.autoPlay){n.handleClick({target:n.links[0],preventDefault:function(){}})}}g._writeDebug("threeSixtyPlayer.init(): Found "+w+" relevant items.");if(n.config.useFavIcon&&typeof this.VUMeter!=="undefined"){this.vuMeter=new this.VUMeter(this)}}}a.prototype.VUMeter=function(g){var d=g,f=this,c=document.getElementsByTagName("head")[0],e=(navigator.userAgent.match(/opera/i)),h=(navigator.userAgent.match(/firefox/i));this.vuMeterData=[];this.vuDataCanvas=null;this.setPageIcon=function(j){if(!d.config.useFavIcon||!d.config.usePeakData||!j){return false}var i=document.getElementById("sm2-favicon");if(i){c.removeChild(i);i=null}if(!i){i=document.createElement("link");i.id="sm2-favicon";i.rel="shortcut icon";i.type="image/png";i.href=j;document.getElementsByTagName("head")[0].appendChild(i)}};this.resetPageIcon=function(){if(!d.config.useFavIcon){return false}var i=document.getElementById("favicon");if(i){i.href="/favicon.ico"}};this.updateVU=function(i){if(soundManager.flashVersion>=9&&d.config.useFavIcon&&d.config.usePeakData){f.setPageIcon(f.vuMeterData[parseInt(16*i.peakData.left,10)][parseInt(16*i.peakData.right,10)])}};this.createVUData=function(){var n=0,m=0,l=f.vuDataCanvas.getContext("2d"),p=l.createLinearGradient(0,16,0,0),k=l.createLinearGradient(0,16,0,0),o="rgba(0,0,0,0.2)";p.addColorStop(0,"rgb(0,192,0)");p.addColorStop(0.3,"rgb(0,255,0)");p.addColorStop(0.625,"rgb(255,255,0)");p.addColorStop(0.85,"rgb(255,0,0)");k.addColorStop(0,o);k.addColorStop(1,"rgba(0,0,0,0.5)");for(n=0;n<16;n++){f.vuMeterData[n]=[]}for(n=0;n<16;n++){for(m=0;m<16;m++){f.vuDataCanvas.setAttribute("width",16);f.vuDataCanvas.setAttribute("height",16);l.fillStyle=k;l.fillRect(0,0,7,15);l.fillRect(8,0,7,15);l.fillStyle=p;l.fillRect(0,15-n,7,16-(16-n));l.fillRect(8,15-m,7,16-(16-m));l.clearRect(0,3,16,1);l.clearRect(0,7,16,1);l.clearRect(0,11,16,1);f.vuMeterData[n][m]=f.vuDataCanvas.toDataURL("image/png")}}};this.testCanvas=function(){var l=document.createElement("canvas"),i=null,j;if(!l||typeof l.getContext==="undefined"){return null}i=l.getContext("2d");if(!i||typeof l.toDataURL!=="function"){return null}try{j=l.toDataURL("image/png")}catch(k){return null}return l};this.init=function(){if(d.config.useFavIcon){f.vuDataCanvas=f.testCanvas();if(f.vuDataCanvas&&(h||e)){f.createVUData()}else{d.config.useFavIcon=false}}};this.init()};a.prototype.Metadata=function(l,d){soundManager._wD("Metadata()");var k=this,j=l._360data.oUI360,e=j.getElementsByTagName("ul")[0],h=e.getElementsByTagName("li"),c=(navigator.userAgent.match(/firefox/i)),f=false,g,m;this.lastWPExec=0;this.refreshInterval=250;this.totalTime=0;this.events={whileplaying:function(){var r=l._360data.width,n=l._360data.radius,s=(l.durationEstimate||(k.totalTime*1000)),p=null,q,o,t;for(q=0,o=k.data.length;q<o;q++){p=(q%2===0);d.drawSolidArc(l._360data.oCanvas,(p?d.config.segmentRingColorAlt:d.config.segmentRingColor),p?r:r,p?n/2:n/2,d.deg2rad(360*(k.data[q].endTimeMS/s)),d.deg2rad(360*((k.data[q].startTimeMS||1)/s)),true)}t=new Date();if(t-k.lastWPExec>k.refreshInterval){k.refresh();k.lastWPExec=t}}};this.refresh=function(){var r,p,o=null,n=l.position,q=l._360data.metadata.data;for(r=0,p=q.length;r<p;r++){if(n>=q[r].startTimeMS&&n<=q[r].endTimeMS){o=r;break}}if(o!==q.currentItem&&o<q.length){l._360data.oLink.innerHTML=q.mainTitle+' <span class="metadata"><span class="sm2_divider"> | </span><span class="sm2_metadata">'+q[o].title+"</span></span>";q.currentItem=o}};this.strToTime=function(n){var o=n.split(":"),q=0,p;for(p=o.length;p--;){q+=parseInt(o[p],10)*Math.pow(60,o.length-1-p)}return q};this.data=[];this.data.givenDuration=null;this.data.currentItem=null;this.data.mainTitle=l._360data.oLink.innerHTML;for(g=0;g<h.length;g++){this.data[g]={o:null,title:h[g].getElementsByTagName("p")[0].innerHTML,startTime:h[g].getElementsByTagName("span")[0].innerHTML,startSeconds:k.strToTime(h[g].getElementsByTagName("span")[0].innerHTML.replace(/[()]/g,"")),duration:0,durationMS:null,startTimeMS:null,endTimeMS:null,oNote:null}}m=d.getElementsByClassName("duration","div",j);this.data.givenDuration=(m.length?k.strToTime(m[0].innerHTML)*1000:0);for(g=0;g<this.data.length;g++){this.data[g].duration=parseInt(this.data[g+1]?this.data[g+1].startSeconds:(k.data.givenDuration?k.data.givenDuration:l.durationEstimate)/1000,10)-this.data[g].startSeconds;this.data[g].startTimeMS=this.data[g].startSeconds*1000;this.data[g].durationMS=this.data[g].duration*1000;this.data[g].endTimeMS=this.data[g].startTimeMS+this.data[g].durationMS;this.totalTime+=this.data[g].duration}};if(navigator.userAgent.match(/webkit/i)&&navigator.userAgent.match(/mobile/i)){soundManager.setup({useHTML5Audio:true})}soundManager.setup({html5PollingInterval:50,debugMode:(b.location.href.match(/debug=1/i)),consoleOnly:true,flashVersion:9,useHighPerformance:true,useFlashBlock:true});if(soundManager.debugMode){b.setInterval(function(){var c=b.threeSixtyPlayer;if(c&&c.lastSound&&c.lastSound._360data.fps&&typeof b.isHome==="undefined"){soundManager._writeDebug("fps: ~"+c.lastSound._360data.fps);c.lastSound._360data.fps=0}},1000)}b.ThreeSixtyPlayer=a}(window));threeSixtyPlayer=new ThreeSixtyPlayer();soundManager.onready(threeSixtyPlayer.init);